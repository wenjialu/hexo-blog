---
title: SmartBrain -  ç”¨ React åšä¸€ä¸ªäººè„¸è¯†åˆ«ç½‘ç«™
date: 2021-12-22 02:35:48
tags: react
---

[TOC]

# ç”¨ React åšä¸€ä¸ªäººè„¸è¯†åˆ«ç½‘ç«™

## å¼•è¨€

React å¯ä»¥è¯´æ˜¯è¿‘äº›å¹´æœ€çƒ­é—¨çš„å‰ç«¯æ¡†æ¶å•¦ï¼Œ å¹¶ä¸”éå¸¸éå¸¸çš„å¥½ç”¨ ~

å¾ˆå¤šçš„å›½å¤–å…¬å¸æ¯”å¦‚ [Netflix](https://zh.wikipedia.org/wiki/Netflix)ã€[Feedly](https://zh.wikipedia.org/wiki/Feedly)ã€[Airbnb](https://zh.wikipedia.org/wiki/Airbnb) éƒ½æ˜¯ç”¨å®ƒæ¥å®ç°çš„ç½‘ç«™ä¸»é¡µã€‚



é‚£ä¹ˆ React åˆ°åº•æ˜¯ä¸ªä»€ä¹ˆå‘¢ï¼Ÿå®ƒå…¶å®æ˜¯ä¸€ä¸ªä¸ºæ•°æ®æä¾›æ¸²æŸ“ä¸º[HTML](https://zh.wikipedia.org/wiki/HTML)è§†å›¾çš„[å¼€æº](https://zh.wikipedia.org/wiki/å¼€æºè½¯ä»¶)[JavaScript åº“](https://zh.wikipedia.org/wiki/JavaScriptå‡½å¼åº“)ã€‚ä¼ è¯´æœ€æ—©èµ·æºäºFacebook çš„å†…éƒ¨é¡¹ç›®ï¼Œç”±äºå¤ªå¥½ç”¨äº†ï¼Œå°±å¼€æºç»™å¤§å®¶ä½¿ç”¨äº†ã€‚



ç°åœ¨å›½å†…çš„å¾ˆå¤šå…¬å¸éƒ½åœ¨æ‹›è˜ä¼š React çš„å‰ç«¯å·¥ç¨‹å¸ˆã€‚è¯´æ˜å¦‚æœä¼šè¿™é¡¹æŠ€æœ¯è¿˜æ˜¯ä¼šå¾ˆåƒé¦™å“’ã€‚

é‚£ä¹ˆæˆ‘ä»¬åº”è¯¥æ€ä¹ˆå­¦ä¹ å®ƒå‘¢ï¼Ÿ 

[å®˜æ–¹æ–‡æ¡£](https://zh-hans.reactjs.org/docs/hello-world.html)å½“ç„¶æ˜¯ä¸€ä¸ªé€‰æ‹© ï½

é‡Œé¢æœ‰å®˜æ–¹äººå‘˜ç»™å‡ºçš„æœ€ä¸¥è°¨çš„å®šä¹‰å’Œæœ€å…¨çš„æ–¹æ³•è§£é‡Šï¼Œä¸€æ­¥ä¸€æ­¥è·Ÿç€å­¦çš„è¯åº”è¯¥ä¹Ÿèƒ½å­¦ä¼šã€‚

ä¸è¿‡ï¼Œç¨æ˜¾æœ‰é‚£ä¹ˆç‚¹ç‚¹æ¯ç‡¥å•¦ã€‚

**æƒ³è¦æ›´å¥½ç©çš„å­¦ä¹ æ–¹æ³•ï¼Œä¸å¦¨æ‰¾ä¸ªå°é¡¹ç›®æ¥ä¸Šæ‰‹å§ã€‚**

å› ä¸ºæ ¹æ®è®¤çŸ¥å¿ƒç†å­¦çš„ç†è®ºï¼Œå­¦ä¹ çš„æœ€å¥½æ–¹æ³•ä¹‹ä¸€å°±æ˜¯åº”ç”¨ ï½

åœ¨â€œåšä¸­å­¦â€ ä¼šæ¯”å•çº¯çš„ â€œçœ‹æ¦‚å¿µâ€ æ›´è®°å¿†æ·±åˆ»å“¦ ï½





æˆ‘ä¹‹å‰åœ¨åˆæ­¥å­¦ä¹  react çš„æ—¶å€™ï¼Œæœ‰å°è¯•ç‰›åˆ€ï¼Œ

åšäº†ä¸€ä¸ªæœºå™¨äººğŸ¤–ï¸ç½‘ç«™ï¼Œç½‘å€åœ¨è¿™é‡Œï¼šhttps://rocky-hamlet-79784.herokuapp.com/  ã€‚æ•™ç¨‹åœ¨æ­¤ï¼š



ä»Šå¤©æƒ³æ•™å¤§å®¶ä¸€ä¸ªå‡çº§ç‰ˆï¼ï¼ï¼ä¸€ä¸ªå¯ä»¥æœ‰ç”¨æˆ·çš„äººè„¸è¯†åˆ«ç½‘ç«™ï½

## æ•ˆæœå±•ç¤º 

https://wenjia-smartbrain.herokuapp.com/ ï¼ˆè¿˜æ²¡å®Œå…¨å®Œæˆå¥½ï¼‰

ç”±äºæ•™ç¨‹ç¯‡å¹…è¿‡é•¿ï¼Œå°†ä¼šåˆ†æˆå››ä¸ªéƒ¨åˆ†ï¼šå‰ç«¯ç¯‡ã€åç«¯ç¯‡ã€æ•°æ®åº“ç¯‡ å’Œ éƒ¨ç½²ç¯‡ã€‚

è·Ÿç€æˆ‘ä¸€èµ·å­¦å®Œï¼Œä¸ä»…èƒ½æŒæ¡ react æ¡†æ¶çš„ä½¿ç”¨ï¼Œè¿˜èƒ½æ‹¥æœ‰ä¸€ä¸ªç‚«é…·çš„ç½‘ç«™å“¦ï½ï½





## æºç  ï¼ˆhideï¼‰

Front end: https://github.com/aneagoie/smart-brain

Back end: https://github.com/aneagoie/smart-brain-api

```bash
Final project for ZTM course

    Clone this repo
    Run npm install
    Run npm start
    You must add your own API key in the src/App.js file to connect to Clarifai.

You can grab Clarifai API key here
```



## å‰ç«¯

å‰ç«¯çš„é¡µé¢æƒ³è®¾è®¡æˆè¿™æ ·ï¼š



![æœªå‘½åæ–‡ä»¶ (2)](/Users/lujiawen/Desktop/æœªå‘½åæ–‡ä»¶ (2).png)

é¦–é¡µå¯ä»¥æ‹†åˆ†æˆ3ä¸ªå…ƒç´ ï¼Œ åˆ†åˆ«æ˜¯ç™»å½•ã€æ³¨å†Œã€å¯¼èˆªæ ã€‚

é‚£å°±æ¯ä¸ªå…ƒç´ åšæˆä¸€ä¸ªç»„ä»¶ã€‚



ç™»å½•åçš„é¡µé¢

![æœªå‘½åæ–‡ä»¶ (1)](/Users/lujiawen/Desktop/æœªå‘½åæ–‡ä»¶ (1).png)



å¯ä»¥æ‹†åˆ†æˆ4 ä¸ªæ¨¡å—ã€‚é™¤å»å¯¼èˆªæ ï¼Œè¿˜æœ‰logoã€æœç´¢æ¡†ã€é¢éƒ¨è¯†åˆ«åŠŸèƒ½åŒºã€‚

è®¾è®¡componentï¼Œå¹¶æ”¾åœ¨app.jsä¸­ ã€‚

tipsï¼šapp.jsä¸­çš„å¤šä¸ª components è¦æ”¾åœ¨ <div></div> é‡Œé¢å“¦ã€‚

```

function App() {
  return (
    <div>
       <Navigation />
       <Logo /> 
        <ImageLinkForm/>
        <FaceRecognition />

    </div>

  );
}

```







### æ³¨å†Œ, ç™»å½•åŠŸèƒ½

#### css

Google æœç´¢ tachyons + forms,  tachyons + card åŠ ä¸ªè¾¹æ¡†

é¡µé¢é¢„è§ˆå’Œä»£ç éƒ½æœ‰å•¦ï½ï½

```jsx
const Signin = () => {
    return(
        // è¿™é‡Œæ”¾htmlä»£ç , 
       //ä¸è¿‡è®°å¾—æŠŠinput åƒè¿™æ · /> close æ‰. for è¦æ”¹æˆhtmlFor, class æ”¹æˆ className
      <article class="center br3 ba b--black-10 mv4 w-100 w-50-m w-25-l shadow-5 mw6 center">
        ...
      <article />  
    )
}

export default Signin;
```

è‡ªè¡Œåˆ åˆ æ”¹æ”¹



#### é¡µé¢

App.js

åŠŸèƒ½ï¼š æ²¡ signin ä¹‹å‰æ˜¯signin é¡µé¢ï¼Œ signin ä¹‹åæ˜¯rank+ä¸Šä¼ image é¡µé¢ã€‚

å®ç°ï¼š constructor()

tips:  jsxè¯­æ³•ï¼š html é‡ŒåŠ äº†{  } å°±å¯ä»¥å†™ js äº†ã€‚

```js
constructor(){
    super()
    this.state = {
      input: "",
      route: "signin"
    }
  }


render() {
    return (
      <div className="App">
         <Navigation />
         { this.state.route === "signin"
          ?  <div>< Signin /></div>
          :  <div> 
            <Logo /> 
            <Rank />
            <ImageLinkForm onInputChange={this.onInputChange} onButtonSubmit={this.onButtonSubmit}/>
            <FaceRecognition />
            <Particles className="particles"
                  params={particleOptions}
                /></div>
         }   
      </div>
  
    );
    }
  }
   

```

åŒç†ï¼Œæ–°å»º register é¡µé¢ã€‚

```
// æ–°å¢ä»£ç 
 <div className="mt3">
                <label className="db fw6 lh-copy f6" htmlFor="name">Name</label>
                <input
                  className="pa2 input-reset ba bg-transparent hover-bg-black hover-white w-100"
                  type="text"
                  name="name"
                  id="name"
                  onChange={this.onNameChange}
                />
              </div>
```





#### é¡µé¢è·³è½¬

è®¾ç½®

```
constructor(){
    super()
    this.state = {
      input: "",
      route: route
      // route: "signin"
    }
  }
  
  
  onRouteChange = (route) => {
    this.setState({route: route});
  }

render() {
    return (
      <div className="App">
         <Navigation onRouteChange = {this.onRouteChange}/>
         { this.state.route === "signin"
          ?  <div>
              <Signin />
              <Particles className="particles"
                    params={particleOptions} />
              </div>
          :  <div> 
              <Logo /> 
              <Rank />
              <ImageLinkForm onInputChange={this.onInputChange} onButtonSubmit={this.onButtonSubmit}/>
              <FaceRecognition />
              <Particles className="particles"
                    params={particleOptions}
                /></div>
         }   
      </div>
  
    );
    }
```







æ·»åŠ ï¼šæ€è·¯ï¼›éœ€è¦è·³è½¬åˆ°ä»€ä¹ˆé¡µé¢ï¼Œ onRouteChange(param)}ï¼Œ paramå°±å†™ä»€ä¹ˆå‚æ•°ã€‚

tipsï¼š åƒä¸‡åˆ«å¿˜äº†åœ¨å‡½æ•°å¤´ä¼ å‚{onRouteChange} ï¼ï¼ï¼ï¼ï¼

Navigation.js  (signout button)

```
onClick={({onRouteChange}) => onRouteChange("signin")}
```



Signin.js 

```
// åƒä¸‡åˆ«å¿˜äº†ä¼ å‚{onRouteChange} ï¼ï¼ï¼ï¼ï¼
// ç®­å¤´å‡½æ•°ï¼šrenderçš„æ—¶å€™ä¸è°ƒç”¨è¿™ä¸ªå‡½æ•°ï¼Œåªæœ‰å½“onClickçš„æ—¶å€™æ‰è°ƒç”¨
//            onClick = {() => onRouteChange("rankpage")}
            
     <div class="">
            <input 
            // ç®­å¤´å‡½æ•°ï¼šrenderçš„æ—¶å€™ä¸è°ƒç”¨è¿™ä¸ªå‡½æ•°ï¼Œåªæœ‰å½“onClickçš„æ—¶å€™æ‰è°ƒç”¨
            onClick = {() => onRouteChange("rankpage")}
            className="b ph3 pv2 input-reset ba b--black bg-transparent grow pointer f6 dib" 
            type="submit" 
            value="Sign in" />
            </div>
            <div class="lh-copy mt3">
            <a onClick = {() => onRouteChange("register")} href="#0" className="f6 link dim black db">Register</a>
                        </div>       
            
```



Register

```
<input 
  // ç®­å¤´å‡½æ•°ï¼šrenderçš„æ—¶å€™ä¸è°ƒç”¨è¿™ä¸ªå‡½æ•°ï¼Œåªæœ‰å½“onClickçš„æ—¶å€™æ‰è°ƒç”¨
  onClick = {() => onRouteChange("signin")}
  className="b ph3 pv2 input-reset ba b--black bg-transparent grow pointer f6 dib" 
  type="submit" 
  value="Register" />
  </div>
```

### 

### ä¸Šä¼ ç…§ç‰‡å¹¶è¯†åˆ«

1. è¯†åˆ«è¾“å…¥æ¡†çš„å†…å®¹ï¼ˆurlï¼‰ï¼š è®¾ç½®stateï¼šinput

2. Detect æŒ‰é’®è¯†åˆ«è¾“å…¥æ¡†çš„å›¾ç‰‡urlï¼šimagelinkform component(oninputchange + onbuttonsubmit)ã€‚
3. åœ¨è¾“å…¥æ¡†ä¸‹æ–¹å±•ç¤ºurlä¸­çš„ç…§ç‰‡ï¼šFaceRecognition component.
4. è¯†åˆ«ç…§ç‰‡ä¸­çš„äººè„¸ï¼šclarifai
5. æ ‡ç¤ºäººè„¸ï¼šæŸ¥çœ‹ clarifai çš„ response -->å†™å…¥åˆ° FaceRecognition component.



#### Step 1. è¾“å…¥æ¡†ï¼ŒæŒ‰é’®æ¡†å¯¹äºè¾“å…¥çš„è¯†åˆ«

App.js è®¾ç½® state,å¹¶æ¸²æŸ“

```
constructor(){
    super()
    this.state = {
      input: ""
    }
  }

  onInputChange = (event) => {
    console.log(event.target.value);
  }

  onButtonSubmit = () => {
    console.log("click");
  }
  
render() {
    return (
      <div className="App">
  
          <ImageLinkForm onInputChange={this.onInputChange} onButtonSubmit={this.onButtonSubmit}/>
         
      </div>
  
    );
    }  
```





ImageLinkForm.js

ä¼ å‚ï¼Œç”¨å‚

```
 <input className="f4 pa2 w-70 center" type="text" onChange={onInputChange}/>
  <button className="w-30 grow f4 link ph3 pv2 dib white bg-light-purple" 
                    onClick = {onButtonSubmit}>Detect</button>
            
```



#### step 2. èƒ½ä¸Šä¼ å›¾ç‰‡

è°ƒç”¨äººå®¶å·²ç»åšå¥½çš„api

clarifai ï¼ˆhttps://www.clarifai.com/ï¼‰

æ³¨å†Œä¸€ä¸ªè´¦æˆ·å°±èƒ½å…è´¹ç”¨äº†

#### step 3. å±•ç¤ºå›¾ç‰‡

```
const FaceRecognition = ({ imageUrl, box }) => {
    return (
      <div className='center ma'>
  
      <div className='absolute mt2'>
        {/* ä¸‹é¢è¿™è¡Œæ˜¯å…³é”®çš„ä»£ç ï¼Œé€šè¿‡srcå±•ç¤ºurlå¯¹åº”çš„å›¾ç‰‡ */} {/* widthï¼Œ heightå›ºå®šå›¾ç‰‡å¤§å° */}
        <img id='inputimage' alt='' src={imageUrl} width='500px' heigh='auto'/>
        {/* æ ‡ç¤ºäººè„¸ */}
        <div className='bounding-box' style={{top: box.topRow, right: box.rightCol, bottom: box.bottomRow, left: box.leftCol}}></div>
      </div>
    </div>
    );
  }
```



#### step4èƒ½è¯†åˆ«å›¾ç‰‡

è°ƒç”¨äººå®¶å·²ç»åšå¥½çš„api, æ³¨å†Œä¸€ä¸ªè´¦æˆ·å°±èƒ½å…è´¹ç”¨äº†

##### æŸ¥çœ‹æ–‡æ¡£

clarifai ï¼ˆhttps://www.clarifai.com/ï¼‰

Model->face dectection = https://www.clarifai.com/models/face-detection

```
https://clarifai.com/developer/
docs.clarifai.com/api-guide/predict/images
```

Googleï¼šnpm clarifai -> GitHub æºç  -> é‡Œé¢æœ‰æ‰€æœ‰çš„æ¨¡å‹

##### ä¸‹è½½

npm install clarifai

##### ä½¿ç”¨

```
const Clarifai = require('clarifai');

//You must add your own API key here from Clarifai. 

const app = new Clarifai.App({

 apiKey: 'æ³¨å†Œåå°±æœ‰äº†'

});

...é™¤äº†äººè„¸è¯†åˆ«ï¼Œè¿˜å¯ä»¥ä½¿ç”¨clarifaiä¸Šä¸åŒçš„æ¨¡å‹åšä¸åŒçš„äº‹æƒ…ï¼ˆè¯†åˆ«è‰²å½©ï¼Œç†è§£å›¾ç‰‡ï¼Œè¯†åˆ«è§†é¢‘ã€‚ã€‚ã€‚ï¼‰

```



### 

### css éƒ¨åˆ†

å› ä¸ºè¦èŠ±å¥½å¤šæ—¶é—´è°ƒè¯•å¥½çœ‹çš„æ ·å¼ï¼Œè€Œæ ·å¼ä¼šæ ¹æ®é¡¹ç›®çš„ä¸åŒè€Œè¿›è¡Œå¾ˆå¤§çš„è°ƒæ•´ã€‚

æ‰€ä»¥è¿™é‡Œå…·ä½“æ ·å¼å°±ç›´æ¥ç»™å¤§å®¶äº†ï¼Œå°±ä¸ç”¨èŠ±å¤ªå¤šæ—¶é—´çº ç»“æ ·å¼äº†ã€‚

#### Magic 1. tachyons

##### å®‰è£…

```
npm install tachyons
npm tachyons

```

##### Index.js å¯¼å…¥

```
import "tachyons";
```

##### ä½¿ç”¨ï¼š

###### Naviation.js

Q: æ˜¯æ€ä¹ˆçŸ¥é“é‡Œé¢çš„æ ·å¼å‘¢ã€‚

A:

1. https://tachyons.io/#style style guide

```
			<nav style = {{display: "flex", justifyContent: "flex-end"}}>
        <p className="f3 link dim black underline pa3 pointer">Sign Out</p>
      </nav>
```

é•¿è¿™æ ·ï¼š

![image-20201120171507674](/Users/lujiawen/Library/Application Support/typora-user-images/image-20201120171507674.png)

2. Google æœç´¢ tachyons + å…³é”®è¯

   eg. tachyons  form

   é¡µé¢é¢„è§ˆå’Œä»£ç éƒ½æœ‰å•¦ï½ï½

```jsx
const Signin = () => {
    return(
        // è¿™é‡Œæ”¾htmlä»£ç , ä¸è¿‡è®°å¾—æŠŠinput åƒè¿™æ · /> close æ‰. for è¦æ”¹æˆhtmlFor
        ...
    )
}

export default Signin;
```


   ![image-20201202211043579](/Users/lujiawen/Library/Application Support/typora-user-images/image-20201202211043579.png)



Ps. å…³äºclassName.

è‡ªå·±åœ¨app.css logo.css é‡Œé¢å®šä¹‰çš„class ä¹Ÿå¯ä»¥ç”¨className å¼•ç”¨

```css
.center{
  display: flex;
  justify-content: center;
}
```





#### Magic 2. React-tilt ï¼ˆfor Logoï¼‰

React-tilt library å¯ä»¥æœ‰ç‚«é…·çš„äº¤äº’ã€‚

å»å®ƒçš„ç½‘ç«™ä¸Šçœ‹å®‰è£…å’Œä½¿ç”¨æ–¹å¼ï¼Œç›´æ¥å¤åˆ¶å°±èƒ½ç”¨äº†

```
npm install --save react-tilt
```

å¥½å¯çˆ±ï¼Œå–œæ¬¢

```
import Tilt from 'react-tilt'
 
<Tilt className="Tilt" options={{ max : 25 }} style={{ height: 250, width: 250 }} >
 <div className="Tilt-inner"> ğŸ‘½ </div>
</Tilt>
```

å¯ä»¥åŠ ä¸€äº›cssæ ·å¼

ç„¶åæŠŠğŸ‘½æ¢æˆè‡ªå·±çš„logo ï¼ˆæ²¡æœ‰çš„è¯å»Googleä¸€ä¸ªå…è´¹çš„ï¼‰

```
import brain from "./xx.png";

<img alt="logo" src={brain} />
```



#### Magic 3. linear-gradient (for background)

è‡ªå·±å»Googleä¸€ä¸ªå¥½çœ‹çš„linear-gradientã€‚

Index.css (indexçš„æ ·å¼ä¼šå½±å“æ•´ä¸ªé¡¹ç›®)

```
body {
  margin: 0;
  padding: 0;
  font-family: sans-serif;
  background: linear-gradient(89deg, #e66465 0% , #9198e5 100%);
}
/* linear-gradient(89deg, #FF5EDF 0%, #04C8DE 100%); */

/* æ‰‹æŒ‡ */
button{
  cursor: pointer;

}
```



#### Magic 4. Particles.js  (for background)

è¶…ç‚«é…·ï¼ï¼ï¼ï¼åŠ¨æ€èƒŒæ™¯

react ç‰ˆæœ¬ï¼š æœç´¢  react Particles npm

```
npm install react-particles-js
```

app.css 

```

.particles{
  position: fixed; 
  top: 0;
  right: 0;
  bottom: 0;
  left: 0;
  /* è¿™æ ·å°±èƒ½ä¸è¦†ç›–å…¶ä»–å±‚äº† */
  z-index: -1;

}
```

app.js 

```
const particleOptions = {
  particles: {
    number:{
      value: 200,
      density: {
        enable: true,
        value_are: 800
      }
    }
    // ,
      // shape: {
      //     type: 'images',
      //     image: [
      //         {src: 'path/to/first/image.svg', height: 20, width: 20},
      //         {src: 'path/to/second/image.jpg', height: 20, width: 20},
      //     ]
      // }
  }
}


åœ¨renderé‡Œé¢ç¬¬ä¸€ä¸ªä½¿ç”¨è¿™ä¸ªæ¨¡å—ã€‚
```



å‚æ•°å†ç ”ç©¶ä¸‹è®©ä»–èƒ½äº’åŠ¨ï¼





#### Magic 5. css3 partern gallery

http://projects.verou.me/css3patterns/



\#\#\## 



ps. å…³äº `<React.StrictMode></React.StrictMode>`

In index.js change `<React.StrictMode><App /></React.StrictMode>` to `<App />` and you will not see this warning. Please note that strict mode helps you with

- Identifying components with unsafe lifecycles
- Warning about legacy string ref API usage
- Warning about deprecated findDOMNode usage
- Detecting unexpected side effects
- Detecting legacy context API

Please refer to https://reactjs.org/docs/strict-mode.html before removing it.







### çŠ¶æ€è½¬åŒ–æ€»ç»“ â­ï¸â­ï¸â­ï¸

(å¯ä»¥æ”¾åˆ° react æ•™ç¨‹ä¸­)

App.js

1 è®¾ç½® constructor: åˆ›å»ºstate, åˆå§‹å€¼å¯ä»¥éšä¾¿è®¾ä¸å½±å“ï¼ˆå› ä¸ºç›®çš„æ˜¯åˆ›å»ºå‡ºstateï¼Œåˆå§‹å€¼ä¸æ˜¯å¾ˆé‡è¦ï¼‰ï¼Œæ¯”å¦‚è®¾ç½®ç©ºâ€œâ€

tipsï¼šjsé‡Œé¢å¸ƒå°”å€¼falseæ‰æ˜¯Fï¼Œ å­—ç¬¦ä¸²â€œfalseâ€æ˜¯Tã€‚æ‰€ä»¥ä¸èƒ½åŠ å¼•å·å“¦ã€‚

```
# éœ€è¦æ—¶è¦ä¼  props 
constructor(){
    super()
    this.state = {
      input: "",
      route: "swf",
      isSignedIn:false
    }
  }
```



2 è®¾ç½®äº‹ä»¶å‡½æ•°ï¼š

å‡½æ•°åŠŸèƒ½ï¼šsetState

```
 onRouteChange = (route) => {
    if (route === 'signout') {
      this.setState({isSignedIn: false})
    } else if (route === 'rankpage') {
      this.setState({isSignedIn: true})
    }

    this.setState({route: route});
  }
```



å‡½æ•°åŠŸèƒ½ï¼šè”ç³»åç«¯

ps. This.props è¡¨ç¤ºå…¨å±€éƒ½èƒ½ç”¨å•¦ï½

```

    // ç®­å¤´å‡½æ•°ï¼šrenderçš„æ—¶å€™ä¸è°ƒç”¨è¿™ä¸ªå‡½æ•°ï¼Œåªæœ‰å½“onClickçš„æ—¶å€™æ‰è°ƒç”¨
    onSubmitSignIn = () => {
        fetch("http://localhost:3000/signin",
        {
            method:"post",
            headers:{"Content-Type":"application/json"},
            body:JSON.stringify({
                name: this.state.name,
                email: this.state.email,
                password: this.state.password
            })
                .then(response => response.json())
                // ä¼ å‚ï¼Œä¼ user
                .then(user =>{
                    if (user.id){
                        this.props.loadUser(user)
                        this.props.onRouteChange("rankpage")
                    }
                })
        })
        console.log(this.state);
    }

```







3 æ¸²æŸ“ 

Tips: onRouteChange æ˜¯å‡½æ•°ï¼Œè°ƒç”¨çš„æ—¶å€™è¦this.onRouteChange

isSignedIn æ˜¯çŠ¶æ€ï¼Œè°ƒç”¨çš„æ—¶å€™è¦this.state.isSignedIn

```
<Navigation isSignedIn = {this.state.isSignedIn} onRouteChange = {this.onRouteChange}/>
```



Component 

æ ¹æ®å…·ä½“æƒ…å†µè°ƒç”¨å‡½æ•°ä¼ å‚ï¼Œä»¥ä¾›æ¸²æŸ“

```js
function Navigation({onRouteChange, isSignedIn}) {
      if (isSignedIn){
        return (
          <nav style = {{display: "flex", justifyContent: "flex-end"}}>
          <p onClick={() => onRouteChange("signout")} className="f3 link dim black underline pa3 pointer">Sign Out</p>
          </nav>)
      } else {
        return (
            <nav style = {{display: "flex", justifyContent: "flex-end"}}>
              <p onClick={() => onRouteChange("signin")} className="f3 link dim black underline pa3 pointer">Sign in</p>  
              <p onClick={() => onRouteChange("register")} className="f3 link dim black underline pa3 pointer">Register</p>
           
          </nav>);         
      }
  }
```





## åç«¯

### å¼€å§‹æ­å»ºæœåŠ¡å™¨

æœ‰äº†æœåŠ¡å™¨å°±èƒ½æœ‰çœŸçš„ç”¨æˆ·æ³¨å†Œï¼Œç™»å‡ºåŠŸèƒ½å•¦ï½

#### æ–°å»ºä¸€ä¸ª smartbrain-api æ–‡ä»¶å¤¹

1. npm init

å®‰è£…ä¸€äº›ä¾èµ–ï¼Œå¦‚expressï¼Œ nodemon ç­‰ ï¼ˆnpm install xxxï¼‰

![image-20201120220035314](/Users/lujiawen/Library/Application Support/typora-user-images/image-20201120220035314.png)

Nodemon: automatically restarts node when file changes are detected in a directory. It replaces the word node when executing a script.
npm install --save-dev nodemon


2. åœ¨æ–‡ä»¶å¤¹é‡Œé¢æ–°å»ºä¸€ä¸ª server.js

```js
const express = require("express");

const app = express();

app.listen(3000, () => {

    console.log("3000")
}
)
```


   åœ¨è„šæœ¬é‡Œé¢è®¾ç½®æ¯æ¬¡ npm start è‡ªåŠ¨å¯åŠ¨server.js

```
  "scripts": {
    "start": "nodemon server.js"
  }
```


æœåŠ¡å™¨å°±æ­å¥½äº†ã€‚



### ç¡®å®šåç«¯ api å…ƒç´  - é€šè¿‡çœ‹ä¸€ä¸‹å‰ç«¯é¡µé¢

å‰ç«¯registeré¡µé¢æœ‰3ä¸ªå…ƒç´ 

login é‡Œé¢æœ‰åå­—ï¼Œrankï¼Œä¸Šä¼ çš„å›¾ç‰‡æ•°



#### åˆæ­¥çš„è®¾è®¡

// register --\> req: POST  res: user 

// signin --\> req: POST  res: success/fail 

// profile userId --\> GET res: user 

// image --\> PUT (æ›´æ–°) res: user count 



### å®ç° api å…ƒç´ 

æ—¢ç„¶å·²ç»ç¡®å®šäº†å‰ç«¯é¡µé¢å…ƒç´ ï¼Œç°åœ¨ä¸ç”¨ç®¡å‰ç«¯äº†ã€‚ç”¨postmanæ¥æ¨¡æ‹Ÿå‰ç«¯request ï¼Œå¹¶æ¥å—åç«¯response



##### register

```js
app.post("/register", (req, res) => {
    const {email, name, password} = req.body
    database.users.push({
        id: "125",
        name: name,
        email: email,
        password: password,
        entries: 0,
        joined: new Date()
    })
    res.json(database.users[database.users.length - 1])
    
})
```

![image-20201202165908426](/Users/lujiawen/Library/Application Support/typora-user-images/image-20201202165908426.png)





##### signin

```js
// å¦‚æœç”¨æˆ·psotçš„åœ¨æ•°æ®åº“é‡Œé¢ï¼Œå°±è¿”å›
app.post("/signin", (req, res) => {
    if (req.body.email === database.users[1].email &&
        req.password === database.users[1].password){
            res.json("success")
        } else{ 
            res.status(400).json("fail")
        }
})
```



##### profile

```js
// å¥½åƒæœ‰ç‚¹é—®é¢˜ï¼Œåªèƒ½è·å–åˆ°ç¬¬ä¸€ä¸ª 123
app.get("/profile/:id", (req, res) =>{
    const {id} = req.params;
    let found = false
    database.users.forEach(user =>{
        if (user.id === id){
            found = true;
            return res.json(user);
        } 
        if (!found){
            res.status(400).json("not found")      
        }     
    })
})
```



Image  for rank

```js

app.put("/image", (req, res) => {
    const {id} = req.params;
    let found = false
    database.users.forEach(user =>{
        if (user.id === id){
            user.entries++;
            return res.json(user.entries);
        } 
        if (!found){
            res.status(400).json("not found")      
        }     
})
```













### ç”¨æˆ·å¯†ç å®‰å…¨ğŸ”

è¿™ä¸ªé¡¹ç›®é‡Œç”¨ bcrypt-nodejs    å®é™…ç”¨bcrypt.js æˆ–è€… bcrypt

é€šè¿‡hash å¯¹ç”¨æˆ·å¯†ç åŠ å¯†

```
We prefer bcrypt for three reasons:  1. bcrypt is 15 years old and has been vetted by the crypto community. Although argon2 won last yearâ€™s password hashing competition, it is still fairly new and we would like to see it have a longer lifespan in the crypto community.  2. scrypt is 7 years old and also a good choice, but bcrypt is a bit easier to implement in a node.js server with simpler documentation as you will see below in the example.  3. The bcrypt npm package is better over other bcrypt implementations available on npm since it is native, highly popular, and vetted by the community without trying to reinvent the wheel.

Now you might be asking yourself, why not just use a hashing function like SHA256, add a salt (randomly generated bytes to place in front of the password) for each user, and store those in a database? The problem with computing power increasing is that attackers can now use GPUs to try out passwords at over 100 million per second and see if they get a hit. Thatâ€™s why you want to use hash functions that were specifically designed to be slow. Although it is fast enough so the user wonâ€™t notice (about 100ms), it is long enough to make it infeasible for an attacker to try out a long list of passwords. bcrypt allows you to add a saltRound (10 is the recommended value) which iterates 2^10, or 1024 times over the password in a process called key stretching. Finally, bcrypt implementation is also safe from timing attacks. 

---- udemy
```



### è¿æ¥ä¸Šå‰ç«¯

å‰åç«¯åœ¨ç°å®ä¸­åº”è¯¥åœ¨ä¸åŒçš„ç”µè„‘ä¸Šã€‚

åç«¯ ç«¯å£ï¼š3000

å‰ç«¯ ç«¯å£ï¼š3001

å…ˆå¯åŠ¨åç«¯ï¼Œå†å¯åŠ¨å‰ç«¯ã€‚ä¼šæç¤ºæˆ‘portè¢«å ç”¨è¦ä¸è¦æ¢ï¼ŒæŒ‰yå°±ä¼šæ¢åˆ°æ–°ç«¯å£äº†ã€‚



#### æµ‹è¯•

åœ¨å‰ç«¯ fetch åç«¯æ ¹è·¯å¾„/çš„å“åº”ï¼Œå¹¶åœ¨æ¸²æŸ“çš„æ—¶å€™æ‰“å°å‡ºæ¥ã€‚

æ ¹è·¯å¾„åœ¨åç«¯è®¾ç½®è¿”å›çš„æ˜¯ç”¨æˆ·æ•°æ®ã€‚

å¯ä»¥åœ¨æµè§ˆå™¨é‡Œé¢çœ‹åˆ°æ‰“å°å‡ºäº†ç”¨æˆ·æ•°æ®ï¼Œè·å–æˆåŠŸï½

![image-20201204234706807](/Users/lujiawen/Library/Application Support/typora-user-images/image-20201204234706807.png)





#### å‰ç«¯ä»£ç æ”¹å†™

Signin.js

Const æ”¹ä¸º classï¼Œ ç›®çš„æ˜¯èƒ½å¤ŸåŠ ä¸Šç›‘å¬è¾“å…¥æ¡†çŠ¶æ€çš„æ–¹æ³•ã€‚

å› ä¸ºè¿™äº›æ˜¯åªå’Œ signin æœ‰å…³çš„æ™ºèƒ½çŠ¶æ€ï¼Œå¯ä»¥å†™åœ¨ component-signin.js é‡Œé¢ã€‚ä¸ç”¨å†™åœ¨ app.js é‡Œé¢è®©ä»–å˜å¾—å¥½è‡ƒè‚¿ã€‚

```
#å˜ä¸ºclassçš„æ“ä½œ
1. class Signin extends React.Component {
 render(){
 	return()
 }
2. const {onRouteChange} = this.props;

# çŠ¶æ€
1 constructor(props){
       super(props);
       this.state =  {
           signInEmail:"",
           signInPassword:"" 
       }
    }

 2   onEmailChange = (event) => {
        this.setState({signInEmail: event.target.value })
    }

    onPasswordChange = (event) => {
        this.setState({signInPassword: event.target.value })
    }

    // ç®­å¤´å‡½æ•°ï¼šrenderçš„æ—¶å€™ä¸è°ƒç”¨è¿™ä¸ªå‡½æ•°ï¼Œåªæœ‰å½“onClickçš„æ—¶å€™æ‰è°ƒç”¨
    onSubmitSignIn = () => {
        console.log(this.state);
        this.props.onRouteChange("rankpage")
    }
3 onChange={this.onEmailChange}
 onClick = {this.onSubmitSignIn}
```

Q:  onSubmitSignIn doesn't work.

#### ä¼ é€æ•°æ®åˆ°æœåŠ¡å™¨

ç”±å‰ç«¯å‘æœåŠ¡å™¨å‘é€è¯·æ±‚

signin.js

```
// ç®­å¤´å‡½æ•°ï¼šrenderçš„æ—¶å€™ä¸è°ƒç”¨è¿™ä¸ªå‡½æ•°ï¼Œåªæœ‰å½“onClickçš„æ—¶å€™æ‰è°ƒç”¨
    onSubmitSignIn = () => {
        fetch("http://localhost:3000/signin",
        {
            method:"post",
            headers:{"Content-Type":"application/json"},
            body:JSON.stringify({
                email: this.state.signInEmail,
                password: this.state.signInPassword
            })

        })
        console.log(this.state);
        this.props.onRouteChange("rankpage")
    }
```

Fetch å¤±è´¥ï¼Œè¿”å›404 not found

æ£€æŸ¥ç½‘ç»œï¼š å‘ç°æˆ‘æ˜æ˜å†™çš„æ–¹æ³•æ˜¯postï¼Œä¸ºå•¥å˜æˆäº†get

æˆ‘ç”¨postæµ‹åç«¯signinæ¥å£æ˜¯æ­£å¸¸çš„å‘€ã€‚

![image-20201205002832834](/Users/lujiawen/Library/Application Support/typora-user-images/image-20201205002832834.png)









#### å…è®¸è·¨åŸŸè®¿é—®

##### æ¦‚å¿µ

by supporting CORS requests, superawesome.com can allow bob.com to access the data.

Read about it more at [MDN's great resource here][1]!

##### æ“ä½œ

Tips: å…ˆ ctrl c æ–­å¼€ nodemon è¿æ¥

npm install cors

const cors = require("cors");

app.use(cors());



#### å¸¸è§å¤±è´¥çš„è§£å†³æ–¹æ¡ˆ

åœ¨åç«¯åŠ å…¥ æ‰“å°errorçš„ä»£ç ï¼Œå°±èƒ½æŸ¥çœ‹åˆ°å¤±è´¥çš„åŸå› ã€‚

å¦‚æœæ˜¯ type errorï¼šfail to fetch

å°±å¯èƒ½æ˜¯å“åº”å¤´æ²¡æœ‰å…è®¸åŒæºï¼Œ å³å‘é€è¯·æ±‚çš„åœ°å€ å’Œ å“åº”è¯·æ±‚çš„åœ°å€ ä¸ä¸€æ ·æ—¶ï¼Œfetch å°±ä¼šå¤±è´¥ã€‚

é—®é¢˜åŸå› ï¼šThe issue could be with the response you are receiving from back-end. If it was working fine on the server then the problem could be with the response headers. Check the *Access-Control-Allow-Origin* (ACAO) in the response headers. Usually react's fetch API will throw fail to fetch even after receiving response when the response headers' ACAO and the origin of request won't match. 

è§£å†³æ–¹æ¡ˆï¼š  If the API is using `express` for node you can use the simple `cors` package. If you want to make your site properly secure, consider using a whitelist for the `Access-Control-Allow-Origin` header.

```
// express ç‰ˆæœ¬

//è®¾ç½®è·¨åŸŸè®¿é—®
app.all('*', function(req, res, next) {
    res.header("Access-Control-Allow-Origin", "*");
    res.header("Access-Control-Allow-Headers", "X-Requested-With");
    res.header("Access-Control-Allow-Methods","PUT,POST,GET,DELETE,OPTIONS");
    res.header("X-Powered-By",' 3.2.1')
    res.header("Content-Type", "application/json;charset=utf-8");
    next();
});

```







* å¿˜è®° npm install clarifai



* App.js:140 SyntaxError: Unexpected token < in JSON at position 0

  è¯´æ˜è¿”å›çš„æ˜¯html é¡µé¢ã€‚å¯ä»¥ç”¨postman è¯•ä¸€ä¸‹ï¼Œå¯ä»¥çœ‹åˆ°é€šå¸¸æ˜¯å› ä¸ºæŸå˜é‡æ²¡æœ‰è¢«å£°æ˜ã€‚

* DevTools failed to load SourceMap: Could not load content for chrome-extension://xxxxxxxxx/writer/js/angular-ui-router.js.map: HTTP error: status code 404, net::ERR_UNKNOWN_URL_SCHEME

  Chrome ä¸Šçš„æ‹“å±•ç¨‹åºåŠ è½½é”™è¯¯ã€‚

  å³ä¸Šè§’ä¸‰ç‚¹ - æ›´å¤šå·¥å…· - æ‹“å±•ç¨‹åºã€‚

  æ‰¾åˆ° id æ˜¯ xxxxx çš„ç¨‹åºï¼Œæ¯”å¦‚æˆ‘å‡ºé”™çš„æ˜¯grammar for ginger ç¨‹åºã€‚

  åŸæ¥æˆ‘æ¯æ¬¡è®¿é—®åç«¯ localhost:3000 çš„æ—¶å€™éƒ½è·‘åˆ°è¿™æ¥äº†ï¼ï¼ æ€ªä¸å¾—é¡µé¢å•¥ååº”ä¹Ÿæ²¡æœ‰ï¼Œæ§åˆ¶å°è¿”å› DevTools failed to load SourceMapï¼Œ çœŸæ˜¯å“­ç¬‘ä¸å¾—ã€‚ã€‚ã€‚

  é‚£å°±å…ˆæŠŠå®ƒå¸è½½äº†å§ã€‚

  ![image-20201216190243433](/Users/lujiawen/Library/Application Support/typora-user-images/image-20201216190243433.png)

![image-20201216190432723](/Users/lujiawen/Library/Application Support/typora-user-images/image-20201216190432723.png)

## æ•°æ®åº“

#### å®‰è£…

![image-20201205005239165](/Users/lujiawen/Library/Application Support/typora-user-images/image-20201205005239165.png)

brew update

brew install postgresql

å®‰è£…æˆåŠŸä¹‹åï¼Œå®‰è£…è·¯å¾„ä¸ºï¼š

/usr/local/var/postgres

å¯ä»¥ pull æœ€æ–°ç‰ˆ

```
brew postgresql-upgrade-database
```



#### å¯åŠ¨

brew services start postgresql

![image-20201205005554035](/Users/lujiawen/Library/Application Support/typora-user-images/image-20201205005554035.png)



createdb "smartbrain"



#### è¿æ¥

ä¸‹è½½å¯è§†åŒ–å›¾å½¢æ“ä½œç•Œé¢ Psequelã€‚

ç”¨ Psequel è¿æ¥æ•°æ®åº“ã€‚

å¦‚æœåœ¨è¿æ¥æœ¬åœ°çš„æ—¶å€™å‡ºé—®é¢˜ï¼ŒæŒ‰ä»¥ä¸‹æ­¥éª¤æ“ä½œã€‚

```text
# 1 æ‰¾åˆ°å®ƒçš„åœ°å€
sudo find / -name "postgresql.conf"
/usr/local/var/postgres/postgresql.conf
# 2
vim postgresql.conf
æŠŠ
listen_addresses = 'localhost'
æ›¿æ¢æˆ
listen_addresses = '*'
# 3
é‡å¯æœåŠ¡å™¨
brew services restart postgresql
# æŸ¥çœ‹
netstat -nlt
â€œLocal Addressâ€ for port 5432 å˜æˆäº† 0.0.0.0.
```



åˆ›å»ºè¡¨

```
CREATE TABLE users(
    id serial PRIMARY KEY,
    name VARCHAR(100),
    email text UNIQUE NOT NULL,
    entries BIGINT DEFAULT 0,
    joined TIMESTAMP NOT NULL
);

CREATE TABLE login(
    id serial PRIMARY KEY,
    hash VARCHAR(100),
    email text UNIQUE NOT NULL
    );
```



è¿™æœ‰è¯¦ç»†çš„ postpresql è¯­æ³•æ•™ç¨‹ https://www.postgresqltutorial.com/







#### knex

Js æ“ä½œæ•°æ®åº“

```
Knex.js (pronounced /kÉ™ËˆnÉ›ks/) is a "batteries included" SQL query builder for Postgres, MSSQL, MySQL, MariaDB, SQLite3, Oracle, and Amazon Redshift designed to be flexible, portable, and fun to use. It features both traditional node style callbacks as well as a promise interface for cleaner async flow control, a stream interface, full featured query and schema builders, transaction support (with savepoints), connection pooling and standardized responses between different query clients and dialects.
```



Npm install knex

npm install pg

å…·ä½“è¯­æ³•åœ¨å®˜ç½‘é‡Œæœ‰ã€‚











## éƒ¨ç½²

è¿™æ ·å…¨ä¸–ç•Œéƒ½èƒ½è®¿é—®å•¦

#### å·¥å…·é€‰æ‹©

å¯ä»¥æœ‰ä»¥ä¸‹é€‰æ‹©ï¼Œåœ¨æ­¤ä½¿ç”¨herokuã€‚

![image-20201205152950920](/Users/lujiawen/Library/Application Support/typora-user-images/image-20201205152950920.png)

heroku éƒ¨åˆ†å¦‚æœæœ‰å•¥ä¸æ‡‚çš„ï¼Œç›´æ¥çœ‹å®˜æ–¹æ–‡æ¡£ https://devcenter.heroku.com/articles/git

https://devcenter.heroku.com/articles/heroku-cli

ã€å¿ƒå¾—: heroku å®˜ç½‘å†™çš„è¿˜ä¸é”™çš„ï¼Œ èƒ½çœ‹ä¸€æ‰‹çš„èµ„æ–™ï¼Œå°±ä¸è¦çœ‹ äºŒä¸‰æ‰‹ç»è¿‡åŠ å·¥çš„èµ„æ–™ğŸ’¾ã€‚ã€‘

### éƒ¨ç½²åç«¯

#### heroku åˆ›å»ºapp

```term
brew tap heroku/brew && brew install heroku
```

Heroku login -i

åˆ°æˆ‘çš„åç«¯æ–‡ä»¶å¤¹ï¼ˆsmart-brain-api) 

Heroku create

```
Creating app... done, â¬¢ damp-eyrie-02199
https://damp-eyrie-02199.herokuapp.com/ | https://git.heroku.com/damp-eyrie-02199.git
```

![image-20201205164210960](/Users/lujiawen/Library/Application Support/typora-user-images/image-20201205164210960.png)



Tips:

å»ºè®®æ–°å»ºå¥½å°±æ”¹æˆè‡ªå·±æƒ³è¦çš„åå­—ã€‚

ä¸ç„¶çš„è¯ï¼Œå»ºç«‹å¥½çš„è¿æ¥åˆè¦åˆ æ‰é‡æ–°å»ºç«‹ã€‚ä¹Ÿä¸æ˜¯ä¸è¡Œï¼Œå°±æ˜¯æ€•å¥½ä¸å®¹æ˜“æèµ·æ¥çš„è¿æ¥ï¼Œä¸‡ä¸€åˆå‡ºä»€ä¹ˆå¹ºè›¾å­è¿ä¸ä¸Šäº†ã€‚

æ”¹åæ–¹æ³•1:

```
1.æ‰“å¼€ç»ˆç«¯ï¼Œç™»å½•herokuï¼Œåˆ‡æ¢åˆ°è¦ä¿®è¯¥çš„appä¸‹
2.æ‰§è¡Œheroku apps:rename xxx (xxxæ˜¯ä½ çš„appçš„æ–°åç§°ï¼‰
3.æ›´æ–°remoteï¼Œ
æ‰§è¡Œgit remote rm heroku
æ‰§è¡Œheroku git:remote -a xxx
```

æ”¹åæ–¹æ³•2:

```
1.æ‰“å¼€herokuçš„ç½‘å€ï¼Œå¹¶ç™»å½•
2.æ‰¾åˆ°ä½ è¦ä¿®æ”¹çš„appçš„åå­—ï¼Œç‚¹å‡»è¿›å…¥
3.ç‚¹å‡»setting
4.ä¿®æ”¹åå­—ï¼ˆåªæ”¯æŒå°å†™å­—æ¯ã€æ•°å­—å’Œç ´æŠ˜å·ï¼‰
5.æ›´æ–°remote
ï¼ˆ1ï¼‰æ‰“å¼€ç»ˆç«¯iterm
ï¼ˆ2ï¼‰è¾“å…¥heroku login, è¾“å…¥emailå’Œpasswordè¿›è¡Œç™»å½•
ï¼ˆ3ï¼‰æ‰§è¡Œgit remote rm heroku
git remote -v
git remote add heroku https://git.heroku.com/XXXXX.gitï¼ˆXXXXXè¯·æ¢æˆä¿®æ”¹åçš„herokuåå­—ï¼‰
git push heroku ä½ çš„æœ€æ–°åˆ†æ”¯:master
```







Heroku open -a appåå­—ï¼Œå¦‚damp-eyrie-02199

![image-20201205172459961](/Users/lujiawen/Library/Application Support/typora-user-images/image-20201205172459961.png)

æˆåŠŸæ‰“å¼€ï½



#### ä¸ GitHub å»ºç«‹è¿æ¥

åœ¨github æ–°å»ºä¸€ä¸ªä»“åº“ smart-brain

è¿˜æ˜¯åœ¨æˆ‘çš„åç«¯æ–‡ä»¶å¤¹ï¼ˆsmart-brain-api) 

```
git init
git add .
git commit -m "smart"

git remote add origin https://github.com/wenjialu/smart-brain.git
git push --set-upstream origin master
```

GitHub è”ç³»ä¸Šherokuï¼Ÿ

```
heroku git:remote -a åˆšåˆšåˆ›çš„appåå­—ï¼Œå¦‚damp-eyrie-02199
```

##### è¿æ¥æˆåŠŸï½

git remote -v æŸ¥çœ‹ä¸‹ï¼Œå¦‚æœheroku å’Œ github çš„ä»“åº“éƒ½å¯¹äº†å°±æ˜¯æˆåŠŸå•¦ï½

![image-20201205174240762](/Users/lujiawen/Library/Application Support/typora-user-images/image-20201205174240762.png)





æˆ‘ä¹‹å‰ç”¨è¿‡herokuäº†ï¼Œç°åœ¨è¦é‡å‘½å



```term
 heroku git:remote -a infinite-hamlet-23870
 git remote rename heroku heroku-staging
```



#### ä¸Šä¼ åˆ°heroku

ä¸Šä¼ åˆ°heroku å•¦ï¼Œè§ä¸‹ï¼š

##### [Deploying code][2]

To deploy your app to Heroku, you typically use the `git push` command to push the code from your local repositoryâ€™s [master or main branch][3] to your `heroku` remote, like so:

```term
# mastet æˆ–è€… main è¦æ ¹æ®å®é™…æƒ…å†µ
$ git push heroku master
Initializing repository, done.
updating 'refs/heads/master'
...
```



#### æŸ¥çœ‹æˆåŠŸäº†æ²¡

```term
heroku open
```

æ£€æŸ¥å‡ºé”™åŸå› 

```
heroku logs --tail
```

é€šè¿‡æ—¥å¿—æˆ‘å‘ç° herokuä¼šä¸ºæˆ‘çš„appè®¾ç½®åŠ¨æ€ç«¯å£ï¼ˆHeroku dynamically assigns your app a portï¼‰ï¼Œæˆ‘è¦æŠŠå†™æ­»çš„3000 ç«¯å£æ”¹æ‰ã€‚

Heroku adds the port to the env, so you can pull it from there. Switch my listen to this:

```js
.listen(process.env.PORT || 3000)
```

åœ¨åç«¯æ–‡ä»¶å¤¹è·¯å¾„ä¸‹ï¼Œç»ˆç«¯è¾“å…¥

```
PORT=5000 node server.js
```

å¯ä»¥çœ‹åˆ°è¿”å›5000 å•¦



ä¿®æ”¹å®Œäº†åˆ«å¿˜è®°ä¸Šä¼ åˆ°git å’Œ heroku

![image-20201205182211270](/Users/lujiawen/Library/Application Support/typora-user-images/image-20201205182211270.png)

å“ˆå“ˆå“ˆå“ˆï½ æˆåŠŸäº†å“¦ï½



### éƒ¨ç½²å‰ç«¯

ç”¨åŒæ ·çš„æ–¹æ³•éƒ¨ç½²å‰ç«¯ã€‚

![image-20201205192330279](/Users/lujiawen/Library/Application Support/typora-user-images/image-20201205192330279.png)

**ä¿®å¤bug**

æç¤º1: node å’Œnpm version éœ€è¦æŒ‡å®š

```
node --version
v12.13.1
npm -v
```

åœ¨ package.jsoné‡Œé¢æ·»åŠ 

```
"engines": {
    "node": "12.13.1",
    "npm": "6.14.8"
  },
```



æç¤º2: ä¾èµ–ä¸­ç¼ºå°‘æ¨¡å—

Tachyon æ¨¡å—ç¼ºå°‘ã€‚

æ‰“å¼€å®ƒç»™å‡ºçš„å®˜æ–¹ç½‘å€ï¼Œæ‰¾åˆ°äº†è§£å†³æ–¹æ¡ˆ

https://devcenter.heroku.com/articles/troubleshooting-node-deploys

https://help.heroku.com/n/13/general-platform-features/builds

```
# é‡è¦ï¼ï¼
In order create a smaller slug size for apps, the buildpack will prune out the devDependencies from the package.json at the end of the build, so that the slug will only include the dependencies that are listed at runtime. If there is a dependency that is in the devDependencies that is needed after the prune occurs, 

move the dependency to dependencies, so it is not removed.
or 
heroku config:set NPM_CONFIG_PRODUCTION=false
```



ä¸çŸ¥é“ä¸ºå•¥ Tachyon æ¨¡å—ä¸è§äº†ã€‚

âš ï¸ æˆ‘æ‰“å¼€æœ¬åœ° package.json å¥½å¤šæ¨¡å—ç«Ÿç„¶éƒ½æ˜¾ç¤ºæ²¡æœ‰å®‰è£…ï¼Œéå¸¸å¥‡æ€ªã€‚

åªèƒ½å…¨éƒ¨é‡æ–°å®‰è£…

```
npm install tachyon 

npm shrinkwrap
äº§ç”Ÿäº†ä¸€ä¸ªæ–°çš„lockfile, ç„¶åå†æäº¤ã€‚ (äº²æµ‹äº†ä¸¤ä¸ªé¡¹ç›®éƒ½ä¸ç”¨lockåè€ŒæˆåŠŸäº†ï¼Œæ‰€ä»¥æŠŠè¿™ä¸ª lockfile åˆ å…‰å…‰ï¼Œé‡æ–°æäº¤gitï¼Œå°±æˆåŠŸå•¦)
```



è£…å¥½ååœ¨dependencies é‡Œé¢å¯ä»¥çœ‹åˆ°å®ƒåˆå‡ºç°å•¦ã€‚

![image-20201206001834886](/Users/lujiawen/Library/Application Support/typora-user-images/image-20201206001834886.png)





```
npm install package-lock.json

heroku buildpacks:set heroku/nodejs

npm shrinkwrap
```



â€‹	

ä¿®å¤ npm å’Œ yarn çš„å†²çªã€‚

```
git rm yarn.lock
git commit -m "Remove yarn lock file"
git push --set-upstream origin master
```

å¦‚æœ git åˆ†æ”¯å‡ºäº†é—®é¢˜ï¼Œè§æˆ‘ git ç¯‡æ›´æ–°éƒ¨åˆ† https://zhuanlan.zhihu.com/p/290333697

```
# æ³¨æ„ï¼ æ ¹æ®é¡¹ç›®çš„å®é™…æƒ…å†µé€‰æ‹© mainï¼Œmaster
git push heroku main
```

```
remote:  ! We have detected that you have triggered a build from source code with version ed530c8d0de5c0f450d117595c65a054dfc9cbe8
remote:  ! at least twice. One common cause of this behavior is attempting to deploy code from a different branch.
remote:  !
remote:  ! If you are developing on a branch and deploying via git you must run:
remote:  !
remote:  !     git push heroku <branchname>:main
remote:  !
remote:  ! This article goes into details on the behavior:
remote:  !   https://devcenter.heroku.com/articles/duplicate-build-version
```

```
git push heroku main:main
```





### éƒ¨ç½²æ•°æ®åº“








[1]:	https://developer.mozilla.org/en-US/docs/Web/HTTP/CORS
[2]:	https://devcenter.heroku.com/articles/git#deploying-code
[3]:	https://devcenter.heroku.com/articles/git-branches
